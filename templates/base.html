<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SneakersMX</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- CSS -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/logo.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <style>
        /* ACCESIBILIDAD */
        #accesibilidad-panel {
            position: fixed;
            top: 50%;
            right: 0;
            transform: translateY(-50%);
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            border-radius: 0.75rem 0 0 0.75rem;
            z-index: 50;
        }
        #accesibilidad-panel button {
            cursor: pointer;
        }
        #accesibilidad-options {
            display: none;
            flex-direction: column;
            gap: 0.5rem;
            padding: 0.75rem;
        }
        #accesibilidad-options.show {
            display: flex;
        }

        /* MODOS ACCESIBILIDAD */
        .grayscale { filter: grayscale(100%); }
        .high-contrast { filter: contrast(200%); }
        .large-cursor * { cursor: pointer !important; }
        .pointer-reader * { outline: 2px solid orange !important; }
        .night-mode { background-color: #111 !important; color: #eee !important; }
    </style>
</head>

<body class="bg-white text-gray-900 font-sans transition-all duration-300">

<!-- NAVBAR PRINCIPAL -->
<header class="navbar flex justify-between items-center px-6 py-4 bg-white shadow-md">

    <!-- LOGO -->
    <a href="{{ url_for('index') }}" class="logo flex items-center text-2xl font-bold">
        üëü <span class="ml-2">SneakersMX</span>
    </a>

    <!-- MEN√ö ESCRITORIO -->
    <nav class="nav-links hidden md:flex gap-8 text-lg">
        <a href="{{ url_for('index') }}" class="hover:text-orange-500 transition">Inicio</a>
        <a href="{{ url_for('productos') }}" class="hover:text-orange-500 transition">Productos</a>
        <a href="{{ url_for('conocenos') }}" class="hover:text-orange-500 transition">Con√≥cenos</a>
        <a href="{{ url_for('contacto') }}" class="hover:text-orange-500 transition">Contacto</a>
    </nav>

    <div class="flex items-center gap-6">
        {% if current_user.is_authenticated %}
            <a href="{{ url_for('logout') }}" class="text-xl text-green-600 font-bold">{{ current_user.nombre }} ‚úñ</a>
        {% else %}
            <div id="btnUsuario" class="cursor-pointer text-2xl"><i class="fas fa-user"></i></div>
        {% endif %}

        <a href="{{ url_for('carrito') }}" class="text-2xl hover:text-orange-500 transition">üõí</a>

        <!-- Men√∫ m√≥vil -->
        <div class="menu-toggle md:hidden cursor-pointer" id="menu-toggle">
            <span class="block w-8 h-1 bg-black mb-1"></span>
            <span class="block w-8 h-1 bg-black mb-1"></span>
            <span class="block w-8 h-1 bg-black"></span>
        </div>
    </div>
</header>

<!-- MEN√ö M√ìVIL -->
<nav class="nav-links-mobile hidden flex-col bg-white shadow-lg p-6 text-lg md:hidden">
    <a href="{{ url_for('index') }}" class="py-2 border-b">Inicio</a>
    <a href="{{ url_for('productos') }}" class="py-2 border-b">Productos</a>
    <a href="{{ url_for('conocenos') }}" class="py-2 border-b">Con√≥cenos</a>
    <a href="{{ url_for('contacto') }}" class="py-2">Contacto</a>
</nav>

<!-- CONTENIDO -->
<main>{% block content %}{% endblock %}</main>

<!-- FOOTER -->
<footer class="text-center py-6 bg-gray-100 mt-8">
    <p>&copy; 2025 SneakersMX. Todos los derechos reservados.</p>
</footer>

<!-- PANEL DE ACCESIBILIDAD -->
<div id="accesibilidad-panel">
    <button id="accesibilidad-toggle" class="p-3 bg-orange-500 text-white rounded-l-xl hover:bg-orange-600 transition" title="Herramientas de accesibilidad">üßë‚Äçü¶Ø</button>
    <div id="accesibilidad-options" class="flex flex-col gap-2 p-4">
        <button onclick="toggleGrayscale()" class="p-2 bg-gray-100 hover:bg-gray-200 rounded">Escala de grises</button>
        <button onclick="toggleContrast()" class="p-2 bg-gray-100 hover:bg-gray-200 rounded">Alto contraste</button>
        <button onclick="increaseText()" class="p-2 bg-gray-100 hover:bg-gray-200 rounded">Aumentar texto</button>
        <button onclick="decreaseText()" class="p-2 bg-gray-100 hover:bg-gray-200 rounded">Disminuir texto</button>
        <button onclick="changeFont()" class="p-2 bg-gray-100 hover:bg-gray-200 rounded">Cambiar tipograf√≠a</button>
        <button onclick="increaseCursor()" class="p-2 bg-gray-100 hover:bg-gray-200 rounded">Cursor grande</button>
        <button onclick="togglePointer()" class="p-2 bg-gray-100 hover:bg-gray-200 rounded">Puntero lector</button>
        <button onclick="toggleNightMode()" class="p-2 bg-gray-100 hover:bg-gray-200 rounded">Modo nocturno</button>
    </div>
</div>

<!-- MODAL LOGIN -->
<div id="modalLogin" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50">
    <div class="bg-white rounded-xl p-6 relative w-80">
        <span class="cerrar-modal absolute top-2 right-3 cursor-pointer text-lg">&times;</span>
        <h2 class="text-xl font-bold mb-4">Iniciar Sesi√≥n</h2>
        <form method="POST" action="{{ url_for('login') }}" class="flex flex-col gap-3">
            <input type="email" name="email" placeholder="Correo electr√≥nico" required class="border p-2 rounded">
            <input type="password" name="password" placeholder="Contrase√±a" required class="border p-2 rounded">
            <button type="submit" class="bg-orange-500 text-white py-2 rounded hover:bg-orange-600 transition">Entrar</button>
        </form>
        <p class="mt-3 text-sm">¬øNo tienes cuenta? <a href="{{ url_for('registro') }}" class="text-orange-500">Crear cuenta</a></p>
    </div>
</div>

<!-- BURBUJA CHAT BOT -->
<div id="chat-bubble" class="fixed bottom-20 right-6 w-16 h-16 bg-gradient-to-br from-orange-500 to-red-500 rounded-full shadow-2xl flex items-center justify-center text-white text-3xl cursor-pointer z-50 transition-transform hover:scale-110">üí¨</div>

<!-- PANEL DE CHAT -->
<div id="chatbox" class="fixed bottom-20 right-6 w-80 bg-white border border-gray-300 rounded-2xl shadow-2xl z-50 hidden flex-col overflow-hidden transform scale-0 transition-transform duration-300">
    <div class="bg-gradient-to-r from-orange-500 to-red-500 text-white p-3 flex justify-between items-center">
        <span>Soporte SneakersMX</span>
        <button id="close-chat" class="text-white text-lg font-bold">‚úñ</button>
    </div>
    <div id="messages" class="flex-1 p-3 overflow-y-auto space-y-2 bg-gray-50"></div>
    <div id="options" class="flex flex-wrap gap-2 p-3 border-t border-gray-200 bg-white"></div>
</div>

<script>
// MEN√ö M√ìVIL
document.getElementById("menu-toggle")?.addEventListener("click", () => {
    document.querySelector(".nav-links-mobile").classList.toggle("active");
});


// ACCESIBILIDAD
document.addEventListener("DOMContentLoaded", () => {
    const toggleBtn = document.getElementById('accesibilidad-toggle');
    const options = document.getElementById('accesibilidad-options');
    toggleBtn.addEventListener('click', () => options.classList.toggle('show'));

    window.toggleGrayscale = () => document.body.classList.toggle('grayscale');
    window.toggleContrast = () => document.body.classList.toggle('high-contrast');
    window.increaseText = () => {
        let size = parseFloat(getComputedStyle(document.body).fontSize);
        document.body.style.fontSize = (size + 2) + 'px';
    };
    window.decreaseText = () => {
        let size = parseFloat(getComputedStyle(document.body).fontSize);
        document.body.style.fontSize = (size - 2) + 'px';
    };
    window.changeFont = () => {
        document.body.style.fontFamily =
            document.body.style.fontFamily === 'Courier New, monospace'
            ? 'Montserrat, sans-serif'
            : 'Courier New, monospace';
    };
    window.increaseCursor = () => document.body.classList.toggle('large-cursor');
    window.togglePointer = () => document.body.classList.toggle('pointer-reader');
    window.toggleNightMode = () => document.body.classList.toggle('night-mode');
});

// BOT√ìN LOGIN
const btnUsuario = document.getElementById("btnUsuario");
const modalLogin = document.getElementById("modalLogin");
const cerrar = document.querySelector(".cerrar-modal");

btnUsuario?.addEventListener("click", () => { modalLogin.classList.remove("hidden"); });
cerrar.addEventListener("click", () => { modalLogin.classList.add("hidden"); });
window.addEventListener("click", (e) => { if (e.target === modalLogin) modalLogin.classList.add("hidden"); });

// CHAT BOT
const chatBubble = document.getElementById("chat-bubble");
const chatbox = document.getElementById("chatbox");
const closeBtn = document.getElementById("close-chat");

chatBubble.addEventListener("click", () => {
    chatbox.classList.toggle("hidden");
    setTimeout(() => chatbox.classList.toggle("scale-0"), 10);
});
closeBtn.addEventListener("click", () => {
    chatbox.classList.add("scale-0");
    setTimeout(() => chatbox.classList.add("hidden"), 300);
});

async function sendOption(option) {
    const messagesDiv = document.getElementById("messages");
    messagesDiv.innerHTML += `<div class="text-right"><span class="inline-block bg-orange-100 text-orange-800 px-3 py-1 rounded-lg">${option}</span></div>`;
    document.getElementById("options").innerHTML = "";

    const res = await fetch("/api/chatbot", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({option})
    });
    const data = await res.json();
    messagesDiv.innerHTML += `<div class="text-left"><span class="inline-block bg-orange-500 text-white px-3 py-1 rounded-lg">${data.reply}</span></div>`;
    messagesDiv.scrollTop = messagesDiv.scrollHeight;

    if (data.options) showOptions(data.options);
}

function showOptions(options) {
    const optionsDiv = document.getElementById("options");
    optionsDiv.innerHTML = "";
    options.forEach(opt => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.className = "bg-gradient-to-br from-orange-400 to-red-400 text-white px-3 py-1 rounded-full hover:from-orange-500 hover:to-red-500 transition-transform hover:scale-105";
        btn.onclick = () => sendOption(opt);
        optionsDiv.appendChild(btn);
    });
}

// Inicia men√∫ principal
showOptions(["Precios", "Env√≠os", "M√©todos de pago", "Disponibilidad", "Productos destacados"]);
</script>

</body>
</html>

